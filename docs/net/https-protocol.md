> 对称加密与非对称加密

我们知道，按照密钥的使用方式，加密分为对称加密和非对称加密。

对称加密就是加密和解密使用同一个密钥，比如 AES，ChaCha20 等加密算法都是使用的对称加密。对称加密的风险就是通信双方如果有一方泄漏了密钥，那整个通信就是不安全的了。

为了解决上述问题，就出现了非对称加密，非对称加密是通过两个密钥来加密的，一个是可以公开的称为公钥，一个是严格保密的称为私钥，使用方式是可以使用公钥加密，然后使用私钥解密，或者使用私钥加密，那就只能用公钥解密，二者一定是配合使用的。

> 那到底是如何通过公钥和私钥来解决密钥传输安全问题的呢？

事实上，我们需要依赖权威机构的介入，因为我们无法判断一个公钥是真实服务商发过来的，还是黑客发过来的。毕竟任何人都可以创建自己的公钥和私钥。

这个权威机构，我们称之为CA（Certificate Authority），假设你自己的网站想要支持HTTPS访问，你需要先在自己的服务器上通过 openssl command line 生成自己的私钥和公钥，此时你会得到一个生成证书请求，你需要将这个证书请求发给CA去认证，将你的公司信息与你生成的公钥进行绑定，CA认证通过后，会使用CA自己的私钥给你的公钥进行加密（称之为签名），表示该CA为你担保了，承认了你的身份。

而CA自己也是需要更权威的CA来担保的，也就是CA自己的公钥也需要更权威的CA来给签名，这样层层上去，直到几个全球皆知的几个著名大CA，称为 root CA，做最后的背书。通过这种层层授信背书的方式，从而保证了非对称加密的传输安全。

对称加密因为使用相同密钥，所以效率高，但存在密钥传输安全性的问题；非对称加密通过使用权威机构认证的公钥和私钥可以解决密钥传输安全性的问题，但效率较低。所以 HTTPS 协议加密采用了二者结合的方式。

> HTTPS 协议加密通信过程

1. 客户端发起加密通信请求，称为 ClientHello 请求，告知自己的协议版本号、加密算法、压缩算法以及一个随机数
2. 服务端响应请求，称为 ServerHello，确认加密通信协议、加密算法后，将网站证书和一个随机数返回给客户端
3. 客户端收到响应后，会先检查证书的可靠性，不通过就弹安全提示，如果通过，客户端向服务器端发送一个称为 pre-master-key 的随机数，该随机数使用证书的公钥加密，以及编码改变通知，客户端完成握手
4. 服务端收到上一步客户端请求后，也会确认之后发送的信息都加密传输，完成握手
5. 此时客户端和服务端双方通过把 第一步客户端随机数、第二步服务端随机数、pre-master-key 使用约定的算法生成同一个密钥来加密以后的通信数据 

> 总结

HTTPS 协议首先使用非对称加密保证客户端与服务端握手环节的安全，握手成功后，使用对称加密进行后续的大量数据传输，以此来达到安全与性能的平衡。
